specVersion: 0.1.0
description: Test WASM substream
codeType: wasm/rust-v1

genesisBlock: 6809737

protoFiles:
- ./pancakeswap.proto

streams:
- name: pair_extractor
  kind: Mapper
  code:
    file: ./wasm-filters/pair_extractor/pkg/pair_extractor_bg.wasm
    entrypoint:  map_pairs
  inputs:
    - proto:sf.ethereum.types.v1.Block
  output:
    type: proto:pcs.types.v1.Pairs

- name: pairs
  kind: StateBuilder
  code:
    file: ./wasm-filters/pair_extractor/pkg/pair_extractor_bg.wasm
    entrypoint: build_pairs_state
  inputs:
    - stream:pair_extractor
  output:
    storeMergeStrategy: LAST_KEY   # SUM_INTS, SUM_FLOATS

- name: reserves_extractor
  kind: Mapper
  code:
    file: ./wasm-filters/pair_extractor/pkg/pair_extractor_bg.wasm
    entrypoint: map_reserves
  inputs:
    - proto:sf.ethereum.types.v1.Block
    - store:pairs
  output:
    type: proto:pcs.types.v1.Reserves
