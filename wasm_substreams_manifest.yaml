specVersion: 0.1.0
description: Test WASM substream
codeType: wasm/rust-v1

genesisBlock: 6809737

protoFiles:
- ./pancakeswap.proto

modules:
- name: pair_extractor
  kind: map
  code:
    file: ./pcs-rust/pkg/pcs_substreams_bg.wasm
    entrypoint: map_pairs
  inputs:
    - source: sf.ethereum.type.v1.Block
  output:
    type: proto:pcs.types.v1.Pairs

- name: pairs
  kind: store
  code:
    file: ./pcs-rust/pkg/pcs_substreams_bg.wasm
    entrypoint: build_pairs_state
  inputs:
    - map: pair_extractor
  output:
    updatePolicy: replace
    valueType: bytes

- name: reserves_extractor
  kind: map
  code:
    file:  ./pcs-rust/pkg/pcs_substreams_bg.wasm
    entrypoint: map_reserves
  inputs:
    - source: sf.ethereum.type.v1.Block
    - store: pairs
  output:
    type: proto:pcs.types.v1.Reserves

# - name: db_out
#   kind: map
#   code:
#     file: ./pcs-rust/pkg/pcs_substreams_bg.wasm
#     entrypoint: map_to_database
#   inputs:
#     - map: reserves_extractor
#     - store: pairs
#       mode: deltas
#     - store: pairs ## Expose `get_at`, `get_first` and `get_last`
#       mode: get
#   output:
#     type: proto:sf.substreams.v1.DebeziumCDC
