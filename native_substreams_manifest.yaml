specVersion: 0.1.0
description: PancakeSwap substreams
codeType: native

genesisBlock: 6809737

protoFiles:
- ./pancakeswap.proto

streams:
- name: pair_extractor
  kind: Mapper
  code:
    native: pcs_pair_extractor
  inputs:
  - proto:sf.ethereum.types.v1.Block
  output:
    type: proto:pcs.types.v1.Pairs

- name: pairs
  kind: StateBuilder
  code:
    native: pcs_pairs_state_builder
  inputs:
  - stream:pair_extractor
  output:
    updatePolicy: replace
    valueType: string

- name: reserves_extractor
  kind: Mapper
  code:
    native: pcs_reserves_extractor
  inputs:
  - proto:sf.ethereum.types.v1.Block
  - store:pairs
  output:
    type: proto:pcs.types.v1.ReserveUpdates

- name: reserves
  kind: StateBuilder
  code:
    native: pcs_reserves_state_builder
  inputs:
  - stream:reserves_extractor
  - store:pairs
  output:
    updatePolicy: replace
    valueType: string

- name: prices
  kind: StateBuilder
  code:
    native: pcs_derived_prices_state_builder
  inputs:
    - stream:reserves_extractor
    - store:pairs
    - store:reserves
  output:
    updatePolicy: replace
    valueType: string

- name: mint_burn_swaps_extractor
  kind: Mapper
  code:
    native: pcs_mint_burn_swaps_extractor
  inputs:
  - proto:sf.ethereum.types.v1.Block
  - store:pairs
  - store:prices
  output:
    type: proto:pcs.types.v1.MintBurnSwaps

- name: totals
  kind: StateBuilder
  code:
    native: pcs_totals_state_builder
  inputs:
  - stream:pair_extractor
  - stream:mint_burn_swaps_extractor
  output:
    updatePolicy: sum
    valueType: int64

- name: volumes
  kind: StateBuilder
  code:
    native: pcs_volumes_state_builder
  inputs:
  - proto:sf.ethereum.types.v1.Block  # Only needed for Number/Timestamp, so a smaller stream would be just as fine.
  - stream:mint_burn_swaps_extractor
  output:
    updatePolicy: sum
    valueType: bigfloat


# $ program manifest.yaml pairsExtractor
