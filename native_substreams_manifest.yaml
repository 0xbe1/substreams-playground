specVersion: 0.1.0
description: PancakeSwap substreams
codeType: native

genesisBlock: 6809737

protoFiles:
- ./pancakeswap.proto

streams:
- name: pairExtractor
  kind: Mapper
  code:
    native: pairExtractor
  inputs:
  - proto:sf.ethereum.types.v1.Block
  output:
    type: proto:pcs.types.v1.Pairs

- name: pairs
  kind: StateBuilder
  code:
    native: pairsState
  inputs:
  - stream:pairExtractor
  output:
    storeMergeStrategy: LAST_KEY   # SUM_INTS, SUM_FLOATS

- name: reservesExtractor
  kind: Mapper
  code:
    native: reservesExtractor
  inputs:
  - proto:sf.ethereum.types.v1.Block
  - store:pairs
  output:
    type: proto:pcs.types.v1.ReserveUpdates

- name: prices
  kind: StateBuilder
  code:
    native: pricesState
  inputs:
  - stream:reservesExtractor
  - store:pairs
  output:
    storeMergeStrategy: LAST_KEY

- name: mintBurnSwapsExtractor
  kind: Mapper
  code:
    native: mintBurnSwapsExtractor
  inputs:
  - proto:sf.ethereum.types.v1.Block
  - store:pairs
  - store:prices
  output:
    type: proto:pcs.types.v1.MintBurnSwaps

- name: totals
  kind: StateBuilder
  code:
    native: totalsState
  inputs:
  - stream:pairExtractor
  - stream:mintBurnSwapsExtractor
  output:
    storeMergeStrategy: SUM_INTS

- name: volumes
  kind: StateBuilder
  code:
    native: volumesState
  inputs:
  - proto:sf.ethereum.types.v1.Block  # Only needed for Number/Timestamp, so a smaller stream would be just as fine.
  - stream:mintBurnSwapsExtractor
  output:
    storeMergeStrategy: SUM_FLOATS


# $ program manifest.yaml pairsExtractor
